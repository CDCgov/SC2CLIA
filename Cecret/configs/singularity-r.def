BootStrap: docker
From: ubuntu:20.04

%post

  # the R version to install
  export R_VERSION=4.0.5

  # install packages needed for the configuration
  apt-get -y update
  apt -y install dirmngr gnupg apt-transport-https ca-certificates software-properties-common

  # Configure default locale
  #echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
  #locale-gen en_US.utf8
  #/usr/sbin/update-locale LANG=en_US.UTF-8
  #export LC_ALL=en_US.UTF-8
  #export LANG=en_US.UTF-8

  # Add the R repository
  apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
  # Note: you need to edit the R version here (check the address below)
  add-apt-repository 'deb https://cloud.r-project.org/bin/linux/ubuntu focal-cran40/'
  apt update

  # Install pkgs
  apt-get install -y libopenblas-dev r-base r-base-core r-base-dev r-recommended jags libcurl4-openssl-dev libopenmpi-dev openmpi-bin openmpi-common openmpi-doc openssh-client openssh-server libssh-dev wget vim git nano cmake gfortran g++ curl wget libxml2-dev libssl-dev pandoc libmagick++-dev 

  # Install required R packages
  R --slave -e 'install.packages(pkgs = "remotes", dependencies = TRUE, lib = "/usr/lib/R/library")'
  R --slave -e 'remotes::install_version(package = "tidyverse", version = "1.3.0", dependencies = TRUE, upgrade = FALSE, quiet = TRUE, build_manual = FALSE, build_vignettes = FALSE, lib = "/usr/lib/R/library")'
  R --slave -e 'remotes::install_version(package = "formattable", version = "0.2.1", dependencies = TRUE, upgrade = FALSE, quiet = TRUE, build_manual = FALSE, build_vignettes = FALSE, lib = "/usr/lib/R/library")'
  R --slave -e 'remotes::install_version(package = "DT", version = "0.17", dependencies = TRUE, upgrade = FALSE, quiet = TRUE, build_manual = FALSE, build_vignettes = FALSE, lib = "/usr/lib/R/library")'
  R --slave -e 'remotes::install_version(package = "docopt", version = "0.7.1", dependencies = TRUE, upgrade = FALSE, quiet = TRUE, build_manual = FALSE, build_vignettes = FALSE, lib = "/usr/lib/R/library")'
  R --slave -e 'remotes::install_version(package = "kableExtra", version = "1.3.4", dependencies = TRUE, upgrade = FALSE, quiet = TRUE, build_manual = FALSE, build_vignettes = FALSE, lib = "/usr/lib/R/library")'
  R --slave -e 'remotes::install_version(package = "dygraphs", version = "1.1.1.6", dependencies = TRUE, upgrade = FALSE, quiet = TRUE, build_manual = FALSE, build_vignettes = FALSE, lib = "/usr/lib/R/library")'
  # Note assuming testthat, knitr, and rmarkdown are installed with dependencies = TRUE on tidyverse.
  rm -rf /tmp/Rtmp*

%environment
  export LC_ALL=C
  # Resolves R failure in containers when TZ is not set and R defaults to timedatectl described in https://github.com/rocker-org/rocker-versioned/issues/242
  export TZ='UTC'

%runscript
#  fortune | cowsay | lolcat

%labels
  Author A. Jo Williams-Newkirk ***REMOVED***